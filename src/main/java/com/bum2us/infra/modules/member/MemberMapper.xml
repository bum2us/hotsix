<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace = "com.bum2us.infra.modules.member.MemberMapper">

	<resultMap id = "resultObj" type="com.bum2us.infra.modules.member.Member"></resultMap>

	<select id="selectList" resultMap = "resultObj">
	
		SELECT
			*
		FROM member
		WHERE
			1=1
		<include refid="searchSql"/>
		<include refid="rangeSql"/>
	</select>
	
	<select id="selectCount" resultType ="Integer" >
		SELECT
			COUNT(*)
		FROM member
		WHERE 1 = 1
		<include refid="searchSql"/>
	</select>
	
	<sql id="rangeSql"> 
		LIMIT #{pageSize} OFFSET #{pageRange}  
	</sql>
	
	<sql id="searchSql">
		AND delNy LIKE 0  
		AND
		<choose>
			<when test= "shOption == null"> name </when>
			<when test= "shOption == 1"> name </when>
			<when test= "shOption == 2"> id </when>
			<when test= "shOption == 3"> nickname </when>
			<when test= "shOption == 4"> email </when>
			<when test= "shOption == 5"> phone </when>
			<when test= "shOption == 6"> gender </when>
		</choose>
		<choose>
			<when test=" shValue == null">LIKE CONCAT ('%','','%')</when>
			<when test=" shValue != null">LIKE CONCAT ('%',#{shValue},'%')</when> 
		</choose> 
			<if test="shGender != null">AND gender LIKE #{shGender}</if> 
		<choose>
			<when test="shDateOption == null">AND  createDate </when>
			<when test="shDateOption == 1">  </when>
			<when test="shDateOption == 2">AND  createDate </when>
			<when test="shDateOption == 3">AND  dob </when>
		</choose>
		<choose>
			<when test = 'shDateStart == null or shDateStart ==""'> BETWEEN CONCAT('1700-01-01', ' 00:00:00') AND CONCAT('2300-01-01',' 00:00:00') </when>
			<when test = "shDateStart != null and shDateEnd != null">BETWEEN #{shDateStart} AND #{shDateEnd}</when> 
		</choose>  
		
	</sql> 

	<select id="selectOneCount" resultType="Integer">
		
		SELECT
			COUNT(*)
		FROM
			member
		WHERE
			1=1
		AND id LIKE #{id};
	
	</select>
	
	<insert id = "insertList">
		
		INSERT INTO member(
		name
		,id
		,password
		,gender
		,email
		,telecom
		,phone
		,comment
		,nickname
		,dob
		,zipCode
		,address
		,addressDetail
		)VALUES(
		
		#{name}
		,#{id}
		,#{password}
		,#{gender}
		,#{email}
		,#{telecom}
		,CONCAT ('010',#{phone1},#{phone2})
		,#{comment}
		,#{nickname}
		,#{dob}
		,#{zipCode}
		,#{address}
		,#{addressDetail}
		)
		
	</insert>
	
	<select id="selectOne" resultMap="resultObj">
		
		SELECT
			*
		FROM member
		WHERE
			1=1
		AND #{shSeq} LIKE seq	
		<!-- WHERE id LIKE #{shId} AND password LIKE #{shPassword} -->
		
	</select>
	
	<select id="chkLogin" resultMap="resultObj">
			SELECT
			*
		FROM member
		WHERE
			1=1
		AND #{id} LIKE id
	</select>
	
	<update id="upadteOne">
		
		UPDATE
			member
		SET
			name = #{name}
			,id = #{id}
			,comment = #{comment}
			,nickname = #{nickname}
			,phone = CONCAT('010',#{phone1},#{phone2})
			,zipCode = #{zipCode}
			,address = #{address}
			,addressDetail = #{addressDetail} 
		WHERE
			1=1
		AND
			seq = #{seq}		
	</update>
	
	<update id ="uelete">
		
		UPDATE
			member
		SET
			delNy = 1
		WHERE
			seq = #{shSeq}
	</update>
	
</mapper> 